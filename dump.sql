CREATE SCHEMA IF NOT EXISTS player_info;
CREATE SCHEMA IF NOT EXISTS match_info;
CREATE SCHEMA IF NOT EXISTS static;

CREATE TABLE IF NOT EXISTS player_info."players" (
    "player_id" BIGINT NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
    "steam_id" BIGINT NOT NULL,
    "prof_name" VARCHAR(255),
    "nickname" VARCHAR(255),
    "rank" SMALLINT
    PRIMARY KEY("player_id")
) TABLESPACE data_space;

COMMENT ON TABLE player_info."players" IS '–ò–≥—Ä–æ–∫–∏, —É—á–∞—Å—Ç–≤—É—é—â–∏–µ –≤ –º–∞—Ç—á–∞—Ö Dota 2';
COMMENT ON COLUMN player_info."players"."steam_id" IS '–°—Å—ã–ª–∫–∞ –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç Steam –∏–≥—Ä–æ–∫–∞';
COMMENT ON COLUMN player_info."players"."prof_name" IS '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –∏–º—è –∏–≥—Ä–æ–∫–∞';
COMMENT ON COLUMN player_info."players"."rank" IS 'Matchmaking –º–µ—Å—Ç–æ –≤ —Ç–æ–ø–µ –∏–≥—Ä–æ–∫–∞';
COMMENT ON COLUMN player_info."players"."nickname" IS '–ù–∏–∫–Ω–µ–π–º –∏–≥—Ä–æ–∫–∞ –≤ –∏–≥—Ä–µ';

------------------------------------------------------

CREATE TABLE IF NOT EXISTS "static"."heroes" (
    "hero_id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
    "hero_name" VARCHAR(255),
    "attribute" VARCHAR(255),
    "attack_type" BOOLEAN,
    PRIMARY KEY("hero_id")
) TABLESPACE data_space;

COMMENT ON TABLE "static"."heroes" IS '–ì–µ—Ä–æ–∏ Dota 2';
COMMENT ON COLUMN "static"."heroes"."hero_name" IS '–ù–∞–∑–≤–∞–Ω–∏–µ –≥–µ—Ä–æ—è';
COMMENT ON COLUMN "static"."heroes"."attribute" IS '–û—Å–Ω–æ–≤–Ω–æ–π –∞—Ç—Ä–∏–±—É—Ç –≥–µ—Ä–æ—è (Strength, Agility, Intelligence)';
COMMENT ON COLUMN "static"."heroes"."attack_type" IS '–¢–∏–ø –∞—Ç–∞–∫–∏: –¥–∞–ª—å–Ω–∏–π (TRUE) –∏–ª–∏ –±–ª–∏–∂–Ω–∏–π (FALSE)';

------------------------------------------------------

CREATE TABLE IF NOT EXISTS "static"."items" (
    "item_id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
    "item_name" VARCHAR(255),
    "cost" INTEGER,
    "recipe" TEXT,
    PRIMARY KEY("item_id")
) TABLESPACE data_space;

COMMENT ON TABLE "static"."items" IS '–ü—Ä–µ–¥–º–µ—Ç—ã, –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –≤ –∏–≥—Ä–µ';
COMMENT ON COLUMN "static"."items"."item_name" IS '–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞';
COMMENT ON COLUMN "static"."items"."cost" IS '–°—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–µ–¥–º–µ—Ç–∞ –≤ –∑–æ–ª–æ—Ç–µ';
COMMENT ON COLUMN "static"."items"."recipe" IS '–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–ª–∏ —Ä–µ—Ü–µ–ø—Ç –ø—Ä–µ–¥–º–µ—Ç–∞';

------------------------------------------------------

CREATE TABLE IF NOT EXISTS "static"."neutral_items" (
    "neutral_items_id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
    "neutral_items_name" VARCHAR(255) NOT NULL,
    "tier" SMALLINT,
    PRIMARY KEY("neutral_items_id")
) TABLESPACE data_space;

COMMENT ON TABLE "static"."neutral_items" IS '–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã, –≤—ã–ø–∞–¥–∞—é—â–∏–µ –≤ –∏–≥—Ä–µ';
COMMENT ON COLUMN "static"."neutral_items"."neutral_items_name" IS '–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞';
COMMENT ON COLUMN "static"."neutral_items"."tier" IS '–£—Ä–æ–≤–µ–Ω—å (—Ä–∞–Ω–≥) –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞';

------------------------------------------------------

CREATE TABLE IF NOT EXISTS "static"."neutral_enchant" (
    "neutral_enchant_id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
    "neutral_enchant_name" VARCHAR(255),
    PRIMARY KEY("neutral_enchant_id")
) TABLESPACE data_space;

COMMENT ON TABLE "static"."neutral_enchant" IS '–≠–Ω—á–∞–Ω—Ç—ã (—É—Å–∏–ª–µ–Ω–∏—è) –¥–ª—è –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤';
COMMENT ON COLUMN "static"."neutral_enchant"."neutral_enchant_name" IS '–ù–∞–∑–≤–∞–Ω–∏–µ —É—Å–∏–ª–µ–Ω–∏—è';

------------------------------------------------------

CREATE TABLE IF NOT EXISTS match_info."matches" (
    "match_id" BIGINT NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
    "duration" INTEGER,
    "winner" BOOLEAN,
    "date" DATE NOT NULL,
    PRIMARY KEY("match_id")
) TABLESPACE data_space;

COMMENT ON TABLE match_info."matches" IS '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—ã–≥—Ä–∞–Ω–Ω—ã—Ö –º–∞—Ç—á–∞—Ö';
COMMENT ON COLUMN match_info."matches"."duration" IS '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–∞—Ç—á–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö';
COMMENT ON COLUMN match_info."matches"."winner" IS '–ü–æ–±–µ–¥–∏–≤—à–∞—è —Å—Ç–æ—Ä–æ–Ω–∞: Radiant (FALSE) –∏–ª–∏ Dire (TRUE)';
COMMENT ON COLUMN match_info."matches"."date" IS '–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –º–∞—Ç—á–∞';

------------------------------------------------------

CREATE TABLE IF NOT EXISTS match_info."player_match_stat" (
    "stat_id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
    "match_id" BIGINT NOT NULL,
    "player_id" BIGINT NOT NULL,
    "hero_id" INTEGER NOT NULL,
    "side" BOOLEAN NOT NULL,
    "pos" VARCHAR(255),
    "kills" SMALLINT NOT NULL DEFAULT 0,
    "deaths" SMALLINT NOT NULL DEFAULT 0,
    "assists" SMALLINT NOT NULL DEFAULT 0,
    "gpm" SMALLINT NOT NULL DEFAULT 0,
    "xpm" SMALLINT NOT NULL DEFAULT 0,
    "last_hit" SMALLINT NOT NULL DEFAULT 0,
    "denies" SMALLINT NOT NULL DEFAULT 0,
    PRIMARY KEY("stat_id")
) TABLESPACE data_space;

COMMENT ON TABLE match_info."player_match_stat" IS '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä–æ–∫–æ–≤ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –º–∞—Ç—á–∞—Ö';
COMMENT ON COLUMN match_info."player_match_stat"."match_id" IS '–°—Å—ã–ª–∫–∞ –Ω–∞ –º–∞—Ç—á';
COMMENT ON COLUMN match_info."player_match_stat"."player_id" IS '–°—Å—ã–ª–∫–∞ –Ω–∞ –∏–≥—Ä–æ–∫–∞';
COMMENT ON COLUMN match_info."player_match_stat"."hero_id" IS '–ì–µ—Ä–æ–π, –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∏–≥—Ä–æ–∫–æ–º';
COMMENT ON COLUMN match_info."player_match_stat"."side" IS '–°—Ç–æ—Ä–æ–Ω–∞: Radiant (FALSE) –∏–ª–∏ Dire (TRUE)';
COMMENT ON COLUMN match_info."player_match_stat"."pos" IS '–ü–æ–∑–∏—Ü–∏—è –∏–≥—Ä–æ–∫–∞ –Ω–∞ –ª–∏–Ω–∏–∏';
COMMENT ON COLUMN match_info."player_match_stat"."kills" IS '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–±–∏–π—Å—Ç–≤';
COMMENT ON COLUMN match_info."player_match_stat"."deaths" IS '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–º–µ—Ä—Ç–µ–π';
COMMENT ON COLUMN match_info."player_match_stat"."assists" IS '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞—Å—Å–∏—Å—Ç–æ–≤';
COMMENT ON COLUMN match_info."player_match_stat"."gpm" IS '–ó–æ–ª–æ—Ç–æ –≤ –º–∏–Ω—É—Ç—É';
COMMENT ON COLUMN match_info."player_match_stat"."xpm" IS '–û–ø—ã—Ç –≤ –º–∏–Ω—É—Ç—É';
COMMENT ON COLUMN match_info."player_match_stat"."last_hit" IS '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–±–∏—Ç—ã—Ö –∫—Ä–∏–ø–æ–≤';
COMMENT ON COLUMN match_info."player_match_stat"."denies" IS '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–Ω–∞–π–µ–≤';

------------------------------------------------------

CREATE TABLE IF NOT EXISTS match_info."player_items" (
    "player_items_id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
    "stat_id" INTEGER NOT NULL,
    "item_id" INTEGER NOT NULL,
    "time_from_start" INTEGER NOT NULL,
    PRIMARY KEY("player_items_id")
) TABLESPACE data_space;

COMMENT ON TABLE match_info."player_items" IS '–ü—Ä–µ–¥–º–µ—Ç—ã, –∫—É–ø–ª–µ–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–æ–º –≤ —Ö–æ–¥–µ –º–∞—Ç—á–∞';
COMMENT ON COLUMN match_info."player_items"."stat_id" IS '–°—Å—ã–ª–∫–∞ –Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–≥—Ä–æ–∫–∞ –≤ –º–∞—Ç—á–µ';
COMMENT ON COLUMN match_info."player_items"."item_id" IS '–°—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç';
COMMENT ON COLUMN match_info."player_items"."time_from_start" IS '–í—Ä–µ–º—è –ø–æ–∫—É–ø–∫–∏ –æ—Ç –Ω–∞—á–∞–ª–∞ –º–∞—Ç—á–∞ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)';

------------------------------------------------------

CREATE TABLE IF NOT EXISTS match_info."player_neutral_items" (
    "player_neutral_items_id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
    "stat_id" INTEGER NOT NULL,
    "neutral_item_id" INTEGER NOT NULL,
    "neutral_enchant_id_" INTEGER NOT NULL,
    "time_from_start" INTEGER NOT NULL,
    "tier" SMALLINT,
    PRIMARY KEY("player_neutral_items_id")
) TABLESPACE data_space;

COMMENT ON TABLE match_info."player_neutral_items" IS '–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã –∏ —ç–Ω—á–∞–Ω—Ç—ã, –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–æ–º';
COMMENT ON COLUMN match_info."player_neutral_items"."stat_id" IS '–°—Å—ã–ª–∫–∞ –Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–≥—Ä–æ–∫–∞ –≤ –º–∞—Ç—á–µ';
COMMENT ON COLUMN match_info."player_neutral_items"."neutral_item_id" IS '–°—Å—ã–ª–∫–∞ –Ω–∞ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç';
COMMENT ON COLUMN match_info."player_neutral_items"."neutral_enchant_id_" IS '–°—Å—ã–ª–∫–∞ –Ω–∞ —ç–Ω—á–∞–Ω—Ç –ø—Ä–µ–¥–º–µ—Ç–∞';
COMMENT ON COLUMN match_info."player_neutral_items"."time_from_start" IS '–í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–µ–¥–º–µ—Ç–∞ –æ—Ç –Ω–∞—á–∞–ª–∞ –º–∞—Ç—á–∞';
COMMENT ON COLUMN match_info."player_neutral_items"."tier" IS '–£—Ä–æ–≤–µ–Ω—å –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞';

------------------------------------------------------

CREATE TABLE IF NOT EXISTS player_info."steam_account" (
    "steam_id" BIGINT NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
    "login" VARCHAR(255) NOT NULL,
    "full_name" VARCHAR(255),
    "nickname" VARCHAR(255) NOT NULL,
    "country" VARCHAR(255),
    "birthday" DATE,
    PRIMARY KEY("steam_id")
) TABLESPACE data_space;

COMMENT ON TABLE player_info."steam_account" IS '–£—á—ë—Ç–Ω—ã–µ –∑–∞–ø–∏—Å–∏ Steam, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –∏–≥—Ä–æ–∫–∞–º–∏';
COMMENT ON COLUMN player_info."steam_account"."login" IS '–õ–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Steam';
COMMENT ON COLUMN player_info."steam_account"."full_name" IS '–ü–æ–ª–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è';
COMMENT ON COLUMN player_info."steam_account"."nickname" IS '–ò–≥—Ä–æ–≤–æ–π –Ω–∏–∫–Ω–µ–π–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è';
COMMENT ON COLUMN player_info."steam_account"."country" IS '–°—Ç—Ä–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è';
COMMENT ON COLUMN player_info."steam_account"."birthday" IS '–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è';

------------------------------------------------------

-- –í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏
-- üîó –í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Å—Ö–µ–º

ALTER TABLE match_info."player_match_stat"
    ADD FOREIGN KEY("hero_id")
    REFERENCES static."heroes"("hero_id")
    ON UPDATE RESTRICT ON DELETE RESTRICT;

ALTER TABLE match_info."player_items"
    ADD FOREIGN KEY("stat_id")
    REFERENCES match_info."player_match_stat"("stat_id")
    ON UPDATE RESTRICT ON DELETE CASCADE;

ALTER TABLE match_info."player_items"
    ADD FOREIGN KEY("item_id")
    REFERENCES static."items"("item_id")
    ON UPDATE RESTRICT ON DELETE RESTRICT;

ALTER TABLE match_info."player_neutral_items"
    ADD FOREIGN KEY("stat_id")
    REFERENCES match_info."player_match_stat"("stat_id")
    ON UPDATE RESTRICT ON DELETE CASCADE;

ALTER TABLE match_info."player_neutral_items"
    ADD FOREIGN KEY("neutral_item_id")
    REFERENCES static."neutral_items"("neutral_items_id")
    ON UPDATE RESTRICT ON DELETE RESTRICT;

ALTER TABLE player_info."players"
    ADD FOREIGN KEY("steam_id")
    REFERENCES player_info."steam_account"("steam_id")
    ON UPDATE RESTRICT ON DELETE CASCADE;

ALTER TABLE match_info."player_match_stat"
    ADD FOREIGN KEY("player_id")
    REFERENCES player_info."players"("player_id")
    ON UPDATE RESTRICT ON DELETE SET NULL;

ALTER TABLE match_info."player_match_stat"
    ADD FOREIGN KEY("match_id")
    REFERENCES match_info."matches"("match_id")
    ON UPDATE RESTRICT ON DELETE CASCADE;

ALTER TABLE match_info."player_neutral_items"
    ADD FOREIGN KEY("neutral_enchant_id")
    REFERENCES static."neutral_enchant"("neutral_enchant_id")
    ON UPDATE NO ACTION ON DELETE NO ACTION;

CREATE INDEX CONCURRENTLY idx_matches_match_id
ON match_info.matches (match_id)
TABLESPACE index_space;

CREATE INDEX CONCURRENTLY idx_player_match_stat_match_id
ON match_info.player_match_stat (match_id)
TABLESPACE index_space;

CREATE INDEX CONCURRENTLY idx_player_match_stat_player_id
ON match_info.player_match_stat (player_id)
TABLESPACE index_space;

CREATE INDEX CONCURRENTLY idx_player_match_stat_hero_id
ON match_info.player_match_stat (hero_id)
TABLESPACE index_space;

CREATE INDEX CONCURRENTLY idx_player_items_item_id
ON match_info.player_items (item_id)
TABLESPACE index_space;

CREATE INDEX CONCURRENTLY idx_player_neutral_items_neutral_item_id
ON match_info.player_neutral_items (neutral_item_id)
TABLESPACE index_space;

CREATE INDEX CONCURRENTLY idx_player_neutral_items_neutral_enchant_id
ON match_info.player_neutral_items (neutral_enchant_id)
TABLESPACE index_space;

CREATE INDEX CONCURRENTLY idx_players_player_id
ON player_info.players (player_id)
TABLESPACE index_space;

CREATE INDEX CONCURRENTLY idx_players_steam_id
ON player_info.players (steam_id)
TABLESPACE index_space;

CREATE INDEX CONCURRENTLY idx_steam_account_steam_id
ON player_info.steam_account (steam_id)
TABLESPACE index_space;

CREATE INDEX CONCURRENTLY idx_steam_account_login
ON player_info.steam_account (login)
TABLESPACE index_space;
